{% extends 'app/user_profile2.html' %}
{% load static %}
{% block title %}Profile{% endblock title %}
{% block leftcontent %}

<style>
    .card-body4{

    background-color: rgba(255, 255, 255, 0.5);
    border-radius:1rem;
    margin:1rem;
    height:60rem;
    padding:1.5rem;
    }

</style>


<div class="container my-5 ">
    <div class="row">
        <div class="col-lg-8 col-sm-12 col-md-8 offset-md-4 card-body4">
            <h4 class="mb-5 text-danger">User Profile</h4>
            <p><strong>Name:</strong> {{ user.username }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>First name & Last name:</strong> {{ user.first_name }} {{ user.last_name }}</p>
            <p><strong>Joined:</strong> {{ user.date_joined|date:"F d, Y" }}</p>
            <p><strong>Benefits of Referral:</strong>When someone joins the website using your referral link, <br>you will receive a reward of 100 rupees for their first signup.</p>
            {% if referral_link %}
            <p><strong>Your referral link</strong>: {{ referral_link }}</p>
            {% else %}
            <p><strong>Generate referral link</strong><a class="generate-link">(click here to generate)</a>:</p>
            <div id="refferal_link"></div>
            {% endif %}

            <a href="{% url 'edit_profile' %}" class="btn text-right "><i class="fa fa-edit"></i></a>

            <button id="showAddressForm" class="btn btn-primary">Add New Address</button>
            <form id="addressForm" action="{% url 'profile' %}" method="post" novalidate style="display: none;">
                {% csrf_token %}
                {% for fm in form %}
                <div class="form-group col-lg-6 mb-3">
                    {{fm.label_tag}} {{fm}} <small class="text-danger">{{fm.errors|striptags}}</small>
                </div>
                {% endfor %}
                <div class="col-12 mt-3">
                    <button type="submit" class="btn btn-primary text-left">Submit</button>
                </div>

            </form>
            {% if messages %}
            {% for message in messages %}
            <p {% if message.tags %} class="alert alert-{{message.tags}} mb-5" {% endif %}>{{message}}</p>
            {% endfor %}
            {% endif %}
        </div>
    </div>




</div>

<script>
document.getElementById("showAddressForm").addEventListener("click", function() {
    var form = document.getElementById("addressForm");
    if (form.style.display === "none" || form.style.display === "") {
        form.style.display = "block";
    } else {
        form.style.display = "none";
    }
});
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$('.generate-link').click(function () {
    $.ajax({
        type: "GET",
        url: "/generate-referral-link/",

        success: function (data) {
            console.log(data);
            console.log("success");
            document.getElementById("refferal_link").innerText = data.referral_link;
        }
    });
});
</script>


{% endblock leftcontent %}